---
title: "Gun Control"
author: "Yuelin Long"
date: "November 16, 2018"
output: github_document
---


```{r include=FALSE}
#Load packages
library(tidyverse)
library(rvest)
library(httr)
```


To quantify how strict are gun controls in different states, we are using:

+ The number of background checks done by U.S. firearms licensees to approximate number of people applied for license; 
+ The number of federal firearms licensees in the U.S. to approximate the number of people get license approved;
+ The proportion of licensees and background checks to indicate approval percentage.

```{r echo=FALSE}

clean_fun = function(address, area){
  readxl::read_xlsx(address, sheet = "Data", range = area) %>% 
  rename(state = X__1) %>% 
  janitor::clean_names()
}


total_pop = clean_fun("./data/population-in-the-states-of-the-us-as-of-2017.xlsx", "B5:C56")

approved_lic = clean_fun("./data/number-of-federal-firearms-licensees-in-the-us-in-2017-by-state.xlsx", "B5:C57") %>% 
  filter(state != "Other Territories")

back_check = clean_fun("./data/nics-background-checks-done-by-us-firearms-licensees-2017-by-state.xlsx", "B5:C56")

approval_rate = inner_join(approved_lic, back_check, by = "state") %>% 
  inner_join(total_pop, by = "state") %>% 
  mutate(app_perc = 100 * number_of_federal_firearms_licensees / number_of_background_checks)

skimr::skim(approval_rate) %>%
            select(variable:stat,value) %>%
            filter(stat != "hist") %>%
            spread(key = stat,value = value) %>% 
  knitr::kable()
```

```{r echo=FALSE}
ggplot(approval_rate, aes(x = number_of_federal_firearms_licensees/number_of_residents_in_millions, y = number_of_background_checks/number_of_residents_in_millions, color = app_perc)) +
  geom_point() +  
  labs(
    title = "Application vs. Proccessed Rate",
    x = "Percentage of people approved",
    y = "Percentage of people processed"
  )

```




```{r echo=FALSE}
library(usmap)

plot_usmap(data = approval_rate, values = "app_perc") + scale_fill_continuous(
    low = "white", high = "red", name = "Approval Percentage (2017)", label = scales::comma
  ) + theme(legend.position = "right")

```

